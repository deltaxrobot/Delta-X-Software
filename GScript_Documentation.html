<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GScript User Guide - Delta X Software</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
        }
        h2 {
            font-size: 1.8em;
            margin-top: 40px;
        }
        h3 {
            font-size: 1.4em;
            margin-top: 25px;
            border-bottom: 1px solid #bdc3c7;
        }
        .code-block {
            background-color: #f8f9fa;
            color: #2d3748;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            margin: 20px 0;
            overflow-x: auto;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.6;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .inline-code {
            background-color: #ecf0f1;
            color: #2c3e50;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .example {
            background-color: #e8f5e8;
            border-left: 4px solid #27ae60;
            padding: 15px;
            margin: 15px 0;
        }
        .warning {
            background-color: #fdf2e6;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin: 15px 0;
        }
        .error {
            background-color: #fdeaea;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 15px 0;
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #bdc3c7;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .toc {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        .toc ul ul {
            padding-left: 20px;
        }
        .toc a {
            text-decoration: none;
            color: #2c3e50;
        }
        .toc a:hover {
            color: #3498db;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>🤖 GScript User Guide</h1>
        <p><strong>Delta X Software - Automated Robot Programming Language</strong></p>

        <div class="toc">
            <h3>📋 Table of Contents</h3>
            <ul>
                <li><a href="#introduction">1. Introduction to GScript</a></li>
                <li><a href="#syntax">2. Basic Syntax</a>
                    <ul>
                        <li><a href="#variables">2.1. Variables</a></li>
                        <li><a href="#comments">2.2. Comments</a></li>
                        <li><a href="#expressions">2.3. Mathematical Expressions</a></li>
                    </ul>
                </li>
                <li><a href="#control-flow">3. Control Flow</a>
                    <ul>
                        <li><a href="#goto">3.1. GOTO - Jump to Line</a></li>
                        <li><a href="#if-then">3.2. IF...ELIF...ELSE...ENDIF - Conditional</a></li>
                        <li><a href="#for-loops">3.3. FOR...ENDFOR - Loops</a></li>
                    </ul>
                </li>
                <li><a href="#subprograms">4. Subprograms</a></li>
                <li><a href="#functions">5. Functions</a></li>
                <li><a href="#math-functions">6. Mathematical Functions</a></li>
                <li><a href="#device-control">7. Device Control</a></li>
                <li><a href="#cloud-point-mapping">8. Cloud Point Mapping System</a>
                    <ul>
                        <li><a href="#cloud-point-intro">8.1. Introduction</a></li>
                        <li><a href="#cloud-point-calibration">8.2. Calibration Functions</a></li>
                        <li><a href="#cloud-point-transformation">8.3. Coordinate Transformation</a></li>
                        <li><a href="#cloud-point-management">8.4. Point Management</a></li>
                        <li><a href="#cloud-point-statistics">8.5. Statistics & Validation</a></li>
                        <li><a href="#cloud-point-file-ops">8.6. File Operations</a></li>
                        <li><a href="#cloud-point-examples">8.7. Examples</a></li>
                    </ul>
                </li>
                <li><a href="#basic-object-processing">9. Basic Object Processing</a></li>
                <li><a href="#examples">10. Practical Examples</a></li>
            </ul>
        </div>

        <h2 id="introduction">1. 🌟 Introduction to GScript</h2>
        <p><strong>GScript</strong> is a programming language integrated into Delta X Software, specifically designed to control Delta X robots and automation devices.</p>

        <div class="example">
            <h4>✅ Main Advantages:</h4>
            <ul>
                <li>🎯 Easy to learn, simple syntax</li>
                <li>🔧 Built-in robot control</li>
                <li>📊 Variable and mathematical expression support</li>
                <li>🔄 Subroutines and loops</li>
                <li>📷 Integrated image processing</li>
                <li>📍 Advanced cloud point mapping</li>
            </ul>
        </div>

        <h2 id="syntax">2. 📝 Basic Syntax</h2>

        <h3 id="variables">2.1. 🔢 Variables</h3>
        <p>Variables in GScript start with <span class="inline-code">#</span> and can store numbers, strings, points, vectors.</p>

        <div class="code-block">; Declare and assign numeric variables
#counter = 0
#speed = 100.5
#robot_name = "Delta_X"

; 2D point variable
#point2d = (150, 200)

; 3D point variable  
#point3d = (150, 200, 80)

; Access point components
#x_pos = #point3d.X
#y_pos = #point3d.Y
#z_pos = #point3d.Z</div>

        <div class="warning">
            <strong>⚠️ Note:</strong> Variable names can contain letters, numbers, and underscores. Cannot start with a number.
        </div>

        <h3 id="label-jump">3.1a. LABEL and JUMP (Named Jump)</h3>
        <p>Use <span class="inline-code">LABEL name</span> to define a jump target, and <span class="inline-code">JUMP name</span> to jump there. Names are case-insensitive.</p>
        <div class="code-block">; Define a label and jump to it
LABEL START
#i = 0
JUMP LOOP

LABEL WORK
G01 X100 Y0
G01 Z-50
JUMP END

LABEL LOOP
IF #i &lt; 3 THEN
    G01 X[#i*10] Y0
    #i = #i + 1
    JUMP LOOP
ENDIF
JUMP WORK

LABEL END
; Program end</div>
        <h3 id="comments">2.2. 💬 Comments</h3>
        <p>Use <span class="inline-code">;</span> to add comments to your code:</p>

        <div class="code-block">; This is a full line comment
G01 X100 Y200 ; End of line comment</div>

        <h3 id="expressions">2.3. 🧮 Mathematical Expressions</h3>
        <p>GScript supports basic and advanced mathematical operations:</p>

        <div class="table-container">
            <table>
                <tr>
                    <th>Operator</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td><span class="inline-code">+</span></td>
                    <td>Addition</td>
                    <td><span class="inline-code">#result = #a + #b</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">-</span></td>
                    <td>Subtraction</td>
                    <td><span class="inline-code">#result = #a - #b</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">*</span></td>
                    <td>Multiplication</td>
                    <td><span class="inline-code">#result = #a * #b</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">/</span></td>
                    <td>Division</td>
                    <td><span class="inline-code">#result = #a / #b</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">%</span></td>
                    <td>Modulo</td>
                    <td><span class="inline-code">#result = #a % #b</span></td>
                </tr>
            </table>
        </div>

        <div class="code-block">; Mathematical expression examples
#radius = 50
#height = #robot0.HOME_Z - 80
#position_x = #center_x + #radius * 2

; Use in G-code
G01 X[#position_x] Y[#center_y] Z[#height]</div>

        <h2 id="control-flow">3. 🔄 Control Flow</h2>

        <h3 id="goto">3.1. GOTO - Jump to Line</h3>
        <p>The <span class="inline-code">GOTO</span> command allows jumping to another line in the program:</p>

        <div class="code-block">N05 #counter = 0
N10 #counter = #counter + 1
N15 G01 X[#counter * 10] Y100
N20 GOTO 10 ; Jump to line N10</div>

        <div class="warning">
            <strong>⚠️ Caution:</strong> Using GOTO can create infinite loops. Always have stop conditions.
        </div>

        <h3 id="if-then">3.2. IF...ELIF...ELSE...ENDIF - ConditionalELIF...ELSE...ENDIF - Conditional</h3>
        <p>GScript supports complete conditional structure with IF-ELIF-ELSE-ENDIF:</p>

        <h4>3.2.1. Single-line syntax:</h4>
        <div class="code-block">; Syntax: IF [condition] THEN [command]
IF #counter == 5 THEN JUMP START
IF #sensor_value > 50 THEN M05

; With ELIF and ELSE
IF #temp > 80 THEN M05
ELIF #temp > 60 THEN M04
ELSE M03</div>

        <h4>3.2.2. Multi-line block syntax:</h4>
        <div class="code-block">; Complete block syntax
IF #counter < 5 THEN
    G01 X[#counter * 10] Y100
    M03
    G04 P1000
ELIF #counter < 10 THEN
    G01 X[#counter * 5] Y200
    M04
ELSE
    G01 X300 Y300
    M05
ENDIF</div>

        <h4>3.2.3. Nested IF:</h4>
        <div class="code-block">IF #mode == 1 THEN
    IF #counter > 5 THEN
        G01 X100 Y100
        M03
    ELSE
        G01 X200 Y200
        M04
    ENDIF
ELIF #mode == 2 THEN
    G01 X300 Y300
    M05
ELSE
    G28 ; Home
ENDIF</div>

        <h4>3.2.4. Comparison Operators:</h4>
        <div class="table-container">
            <table>
                <tr>
                    <th>Comparison Operator</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td><span class="inline-code">==</span></td>
                    <td>Equal</td>
                    <td><span class="inline-code">IF #a == 5 THEN GOTO 100</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">!=</span></td>
                    <td>Not equal</td>
                    <td><span class="inline-code">IF #a != 0 THEN M03</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">></span></td>
                    <td>Greater than</td>
                    <td><span class="inline-code">IF #temp > 60 THEN M05</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code"><</span></td>
                    <td>Less than</td>
                    <td><span class="inline-code">IF #speed < 100 THEN G01 F200</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">>=</span></td>
                    <td>Greater than or equal</td>
                    <td><span class="inline-code">IF #counter >= 10 THEN GOTO 50</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code"><=</span></td>
                    <td>Less than or equal</td>
                    <td><span class="inline-code">IF #pressure <= 30 THEN M04</span></td>
                </tr>
            </table>
        </div>

        <h4>3.2.5. Logical Operators:</h4>
        <p>GScript supports logical operators for complex conditions:</p>
        
        <div class="table-container">
            <table>
                <tr>
                    <th>Logical Operator</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td><span class="inline-code">AND</span></td>
                    <td>Logical AND</td>
                    <td><span class="inline-code">IF #temp > 60 AND #pressure < 100 THEN M05</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">OR</span></td>
                    <td>Logical OR</td>
                    <td><span class="inline-code">IF #mode == 1 OR #mode == 2 THEN M03</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">NOT</span></td>
                    <td>Logical NOT</td>
                    <td><span class="inline-code">IF NOT #sensor_active THEN M04</span></td>
                </tr>
            </table>
        </div>

        <div class="code-block">; Complex logical conditions
IF #temp > 60 AND #pressure < 100 THEN
    M05 ; Emergency stop
ELIF #mode == 1 OR #mode == 2 THEN
    M03 ; Start operation
ELIF NOT #sensor_active THEN
    M04 ; Sensor not active
ELSE
    G28 ; Default action
ENDIF</div>

        <h3 id="for-loops">3.3. 🔄 FOR...ENDFOR - Loops</h3>
        <p>GScript supports two types of FOR loops:</p>

        <h4>3.3.1. Numeric FOR loops:</h4>
        <div class="code-block">; Syntax: FOR var = start TO end [STEP step]
FOR #i = 1 TO 5
    G01 X[#i * 10] Y100
    M03
    G04 P1000
    M05
ENDFOR

; With custom STEP
FOR #i = 0 TO 100 STEP 10
    G01 X[#i] Y200
    G04 P500
ENDFOR

; Reverse loop
FOR #i = 10 TO 1 STEP -1
    G01 X[#i * 15] Y300
    G04 P200
ENDFOR</div>

        <h4>3.3.2. FOREACH loops (for objects):</h4>
        <div class="code-block">; Syntax: FOR EACH var IN listName
FOR EACH #obj IN objects
    ; Variable #obj contains current object index
    ; Automatically creates convenience variables:
    ; #obj_current_X, #obj_current_Y, #obj_current_Z
    ; #obj_current_W, #obj_current_L, #obj_current_A
    
    G01 X[#obj_current_X] Y[#obj_current_Y]
    G01 Z-150
    M03
    G04 P1000
    G01 Z-50
ENDFOR</div>

        <h4>3.3.3. Nested FOR loops:</h4>
        <div class="code-block">; Nested loops
FOR #row = 1 TO 5
    FOR #col = 1 TO 3
        #x_pos = #col * 30
        #y_pos = #row * 40
        
        G01 X[#x_pos] Y[#y_pos]
        G01 Z-150
        M03
        G04 P500
        M05
        G01 Z-50
    ENDFOR
ENDFOR</div>

        <h4>3.3.4. FOR combined with IF:</h4>
        <div class="code-block">; Conditional processing in loops
FOR #i = 1 TO 10
    IF #i % 2 == 0 THEN
        ; Process even numbers
        G01 X[#i * 10] Y100
        M03
    ELSE
        ; Process odd numbers
        G01 X[#i * 10] Y200
        M04
    ENDIF
    
    G04 P800
    M05
ENDFOR</div>

        <h2 id="subprograms">4. 🔧 Subprograms</h2>
        <p>Use subprograms to reuse code and organize programs better:</p>

        <h3>4.1. Define Subprogram</h3>
        <div class="code-block">; Define subprogram
O2001 ; Start subprogram number 2001
    G01 Z[#robot0.HOME_Z - 50]
    M03 ; Turn on gripper
    G04 P1000 ; Wait 1 second
    M05 ; Turn off gripper
M99 ; End subprogram</div>

        <h3>4.2. Call Subprogram</h3>
        <div class="code-block">; Call subprogram
M98 P2001 ; Call subprogram O2001</div>

        <h2 id="functions">5. Functions</h2>
        <p>GScript supports creating and calling custom functions to reuse code and organize programs better.</p>

        <h3>5.1. Function Declaration</h3>
        <div class="code-block">; Syntax: FUNCTION functionName(param1, param2, ...)
FUNCTION pickObject(x, y, z)
    G01 X[x] Y[y] Z-50 F1000
    G01 Z[z]
    M03 ; Turn on gripper
    G04 P1000
    G01 Z-50
ENDFUNCTION</div>

        <h3>5.2. Function Call</h3>
        <div class="code-block">; Call function without return value
pickObject(100, 200, -150)

; Call function with variables
#pick_x = 150
#pick_y = 250
#pick_z = -140
pickObject(#pick_x, #pick_y, #pick_z)</div>

        <h3>5.3. Functions with Return Values</h3>
        <div class="code-block">; Function that calculates distance between two points
FUNCTION calculateDistance(x1, y1, x2, y2)
    #dx = x2 - x1
    #dy = y2 - y1
    #distance = #sqrt(#dx * #dx + #dy * #dy)
    RETURN #distance
ENDFUNCTION

; Use function with return value
#dist = calculateDistance(0, 0, 100, 100)
IF #dist > 50 THEN
    G01 F500 ; Slow speed for long distance
ELSE
    G01 F1000 ; Fast speed for short distance
ENDIF</div>

        <div class="warning">
            <h4>Important Notes about Functions:</h4>
            <ul>
                <li>Functions can call each other (including recursion)</li>
                <li>Parameters are local to the function (do not overwrite globals with the same name)</li>
                
                <li>Always use RETURN to end functions clearly</li>
                <li>Function calls use the bare name: <span class="inline-code">func(args)</span></li>
            </ul>
        </div>

        <h2 id="math-functions">6. 📐 Mathematical Functions</h2>
        <p>GScript provides built-in mathematical functions:</p>

        <div class="table-container">
            <table>
                <tr>
                    <th>Function</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td><span class="inline-code">#sin(angle)</span></td>
                    <td>Sine (degrees)</td>
                    <td><span class="inline-code">#y = #sin(30)</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cos(angle)</span></td>
                    <td>Cosine (degrees)</td>
                    <td><span class="inline-code">#x = #cos(45)</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">#tan(angle)</span></td>
                    <td>Tangent (degrees)</td>
                    <td><span class="inline-code">#slope = #tan(60)</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">#atan(value)</span></td>
                    <td>Arctangent (to degrees)</td>
                    <td><span class="inline-code">#angle = #atan(1)</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">#atan2(y,x)</span></td>
                    <td>Arctangent2 (to degrees)</td>
                    <td><span class="inline-code">#angle = #atan2(1,1)</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">#abs(value)</span></td>
                    <td>Absolute value</td>
                    <td><span class="inline-code">#dist = #abs(-5)</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">#sqrt(value)</span></td>
                    <td>Square root</td>
                    <td><span class="inline-code">#hyp = #sqrt(25)</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">#pow(base,exp)</span></td>
                    <td>Power</td>
                    <td><span class="inline-code">#result = #pow(2,3)</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">#round(value)</span></td>
                    <td>Round</td>
                    <td><span class="inline-code">#int = #round(3.7)</span></td>
                </tr>
            </table>
        </div>

        <div class="example">
            <h4>Example: Calculate position on a circle:</h4>
            <div class="code-block">#center_x = 100
#center_y = 150
#radius = 50
#angle = 45

#x = #center_x + #radius * #cos(#angle)
#y = #center_y + #radius * #sin(#angle)

G01 X[#x] Y[#y]</div>
        </div>

        <h2 id="device-control">7. 🎛️ Device Control</h2>

        <h3>7.1. Robot Control</h3>
        <div class="table-container">
            <table>
                <tr>
                    <th>Command</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td><span class="inline-code">G28</span></td>
                    <td>Home</td>
                    <td><span class="inline-code">G28</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">G01</span></td>
                    <td>Linear movement</td>
                    <td><span class="inline-code">G01 X100 Y200 Z50 F1000</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">G02</span></td>
                    <td>Clockwise arc movement</td>
                    <td><span class="inline-code">G02 X100 Y100 I50 J0</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">G03</span></td>
                    <td>Counter-clockwise arc movement</td>
                    <td><span class="inline-code">G03 X100 Y100 I50 J0</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">G04</span></td>
                    <td>Pause (ms)</td>
                    <td><span class="inline-code">G04 P1000</span></td>
                </tr>
            </table>
        </div>

        <h3>7.2. End Effector Control</h3>
        <div class="table-container">
            <table>
                <tr>
                    <th>Command</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td><span class="inline-code">M03</span></td>
                    <td>Turn on Gripper/Laser</td>
                    <td><span class="inline-code">M03 S100</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">M04</span></td>
                    <td>Turn on Gripper reverse</td>
                    <td><span class="inline-code">M04 S50</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">M05</span></td>
                    <td>Turn off Gripper/Laser</td>
                    <td><span class="inline-code">M05</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">M360</span></td>
                    <td>Select End Effector</td>
                    <td><span class="inline-code">M360 E1</span></td>
                </tr>
            </table>
        </div>

        <h3>7.3. Conveyor Control</h3>
        <div class="table-container">
            <table>
                <tr>
                    <th>Command</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td><span class="inline-code">M310</span></td>
                    <td>Select speed mode</td>
                    <td><span class="inline-code">M310 S1</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">M311</span></td>
                    <td>Set speed</td>
                    <td><span class="inline-code">M311 S100</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">M312</span></td>
                    <td>Set position</td>
                    <td><span class="inline-code">M312 X100</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">M313</span></td>
                    <td>Speed for position movement</td>
                    <td><span class="inline-code">M313 S200</span></td>
                </tr>
            </table>
        </div>

        <h3>7.4. Device Selection</h3>
        <div class="code-block">; Select default device
SELECT robot0 ; Select robot
SELECT conveyor0 ; Select conveyor
SELECT device0 ; Select device

; Send command to specific device
robot0 G01 X100 Y200
conveyor0 M311 S100</div>

        <h2 id="cloud-point-mapping">8. 📍 Cloud Point Mapping System</h2>
        <p><strong>Cloud Point Mapping System (CPMS)</strong> is an advanced coordinate mapping system for Delta X robots, supporting coordinate transformation from camera/pixel coordinates to real-world coordinates with high precision.</p>

        <h3 id="cloud-point-intro">8.1. 🌟 Introduction</h3>
        <p>CPMS provides 25+ functions for:</p>
        <ul>
            <li>📊 Managing calibration points (add, remove, update)</li>
            <li>🎯 Coordinate transformation with 5 interpolation methods</li>
            <li>📈 Mapping statistics and validation</li>
            <li>💾 Save/load mapping configurations</li>
            <li>🔄 Integration with VariableManager</li>
        </ul>

        <div class="example">
            <h4>✅ Interpolation Methods:</h4>
            <ul>
                <li><strong>0 = Linear:</strong> Fast and simple</li>
                <li><strong>1 = Bilinear:</strong> Good for grid data (default)</li>
                <li><strong>2 = Cubic Spline:</strong> Smooth, high accuracy</li>
                <li><strong>3 = Radial Basis:</strong> Good for irregular data</li>
                <li><strong>4 = Kriging:</strong> Best for statistical data</li>
            </ul>
        </div>

        <h3 id="cloud-point-calibration">8.2. 🔧 Calibration Functions</h3>
        <p>Functions for managing calibration points:</p>

        <div class="table-container">
            <table>
                <tr>
                    <th>Function</th>
                    <th>Description</th>
                    <th>Parameters</th>
                    <th>Return</th>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointAddCalibration(imageX, imageY, imageZ, realX, realY, realZ, confidence, label)</span></td>
                    <td>Add new calibration point</td>
                    <td>6 coordinates + confidence (0-1) + label (optional)</td>
                    <td>Point index (-1 if error)</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointRemove(index)</span></td>
                    <td>Remove calibration point</td>
                    <td>Point index to remove</td>
                    <td>1 if successful, 0 if error</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointUpdate(index, imageX, imageY, imageZ, realX, realY, realZ, confidence)</span></td>
                    <td>Update calibration point</td>
                    <td>Index + 6 coordinates + confidence</td>
                    <td>1 if successful, 0 if error</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointClear()</span></td>
                    <td>Clear all calibration points</td>
                    <td>None</td>
                    <td>1 if successful</td>
                </tr>
            </table>
        </div>

        <div class="code-block">; Add calibration point
#index = #cloudPointAddCalibration(100, 200, 0, 150.5, 250.3, -100, 0.95, "point1")

; Update point
#cloudPointUpdate(#index, 105, 205, 0, 152.1, 252.8, -98, 0.98)

; Remove point
#cloudPointRemove(#index)</div>

        <h3 id="cloud-point-transformation">8.3. 🎯 Coordinate Transformation</h3>
        <p>Functions for transforming coordinates from image/pixel to real-world:</p>

        <div class="table-container">
            <table>
                <tr>
                    <th>Function</th>
                    <th>Description</th>
                    <th>Parameters</th>
                    <th>Return</th>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointTransformX(imageX, imageY, imageZ, method)</span></td>
                    <td>Transform to real X coordinate</td>
                    <td>3 image coordinates + method (0-4)</td>
                    <td>Real X coordinate</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointTransformY(imageX, imageY, imageZ, method)</span></td>
                    <td>Transform to real Y coordinate</td>
                    <td>3 image coordinates + method (0-4)</td>
                    <td>Real Y coordinate</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointTransformZ(imageX, imageY, imageZ, method)</span></td>
                    <td>Transform to real Z coordinate</td>
                    <td>3 image coordinates + method (0-4)</td>
                    <td>Real Z coordinate</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetConfidence(imageX, imageY, imageZ, method)</span></td>
                    <td>Get transformation confidence</td>
                    <td>3 image coordinates + method (0-4)</td>
                    <td>Confidence (0-1)</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetError(imageX, imageY, imageZ, method)</span></td>
                    <td>Get estimated error</td>
                    <td>3 image coordinates + method (0-4)</td>
                    <td>Error (mm)</td>
                </tr>
            </table>
        </div>

        <div class="code-block">; Transform coordinates from camera to robot
#pixel_x = 320
#pixel_y = 240 
#pixel_z = 0

; Use Bilinear interpolation (method = 1)
#real_x = #cloudPointTransformX(#pixel_x, #pixel_y, #pixel_z, 1)
#real_y = #cloudPointTransformY(#pixel_x, #pixel_y, #pixel_z, 1)
#real_z = #cloudPointTransformZ(#pixel_x, #pixel_y, #pixel_z, 1)

; Check confidence
#confidence = #cloudPointGetConfidence(#pixel_x, #pixel_y, #pixel_z, 1)
IF #confidence > 0.8 THEN
    ; Move robot to position
    G01 X[#real_x] Y[#real_y] Z[#real_z]
ELSE
    ; Low confidence, need more calibration
    M98 PshowWarning("Low confidence transformation")
ENDIF</div>

        <h3 id="cloud-point-management">8.4. 📊 Point Management</h3>
        <p>Functions for managing and querying point information:</p>

        <div class="table-container">
            <table>
                <tr>
                    <th>Function</th>
                    <th>Description</th>
                    <th>Parameters</th>
                    <th>Return</th>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetCount()</span></td>
                    <td>Get number of calibration points</td>
                    <td>None</td>
                    <td>Number of points</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetImageX(index)</span></td>
                    <td>Get image X coordinate</td>
                    <td>Point index</td>
                    <td>Image X</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetImageY(index)</span></td>
                    <td>Get image Y coordinate</td>
                    <td>Point index</td>
                    <td>Image Y</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetImageZ(index)</span></td>
                    <td>Get image Z coordinate</td>
                    <td>Point index</td>
                    <td>Image Z</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetRealX(index)</span></td>
                    <td>Get real X coordinate</td>
                    <td>Point index</td>
                    <td>Real X</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetRealY(index)</span></td>
                    <td>Get real Y coordinate</td>
                    <td>Point index</td>
                    <td>Real Y</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetRealZ(index)</span></td>
                    <td>Get real Z coordinate</td>
                    <td>Point index</td>
                    <td>Real Z</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetPointConfidence(index)</span></td>
                    <td>Get point confidence</td>
                    <td>Point index</td>
                    <td>Confidence (0-1)</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetPointError(index)</span></td>
                    <td>Get point error</td>
                    <td>Point index</td>
                    <td>Error (mm)</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetLabel(index)</span></td>
                    <td>Get point label</td>
                    <td>Point index</td>
                    <td>Label string</td>
                </tr>
            </table>
        </div>

        <div class="code-block">; Iterate through all calibration points
#total_points = #cloudPointGetCount()
FOR #i = 0 TO #total_points - 1
    #img_x = #cloudPointGetImageX(#i)
    #img_y = #cloudPointGetImageY(#i)
    #real_x = #cloudPointGetRealX(#i)
    #real_y = #cloudPointGetRealY(#i)
    #confidence = #cloudPointGetPointConfidence(#i)
    #label = #cloudPointGetLabel(#i)
    
    ; Display point information
    ; Note: showInfo function would need to be implemented
ENDFOR</div>

        <h3 id="cloud-point-statistics">8.5. 📈 Statistics & Validation</h3>
        <p>Functions for statistics and validation of mapping system:</p>

        <div class="table-container">
            <table>
                <tr>
                    <th>Function</th>
                    <th>Description</th>
                    <th>Parameters</th>
                    <th>Return</th>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointBuildGrid(resolution)</span></td>
                    <td>Build grid mapping</td>
                    <td>Resolution (10.0 = default)</td>
                    <td>1 if successful, 0 if error</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointValidate(validationRatio)</span></td>
                    <td>Validate mapping accuracy</td>
                    <td>Ratio (0.2 = 20% points for validation)</td>
                    <td>1 if valid, 0 if not</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointGetStats()</span></td>
                    <td>Get mapping statistics</td>
                    <td>None</td>
                    <td>String containing statistics</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointIsValid()</span></td>
                    <td>Check if mapping is valid</td>
                    <td>None</td>
                    <td>1 if valid, 0 if not</td>
                </tr>
            </table>
        </div>

        <div class="code-block">; Build and validate mapping
#cloudPointBuildGrid(15.0) ; Grid resolution 15mm

; Validate with 20% of points
#validation_result = #cloudPointValidate(0.2)
IF #validation_result == 1 THEN
    #stats = #cloudPointGetStats()
    ; Mapping validation successful
ELSE
    ; Mapping validation failed. Need more calibration points.
ENDIF

; Check if mapping is ready for use
IF #cloudPointIsValid() == 1 THEN
    ; Cloud Point Mapping ready for use
ELSE
    ; Cloud Point Mapping not ready. Add more calibration points.
ENDIF</div>

        <h3 id="cloud-point-file-ops">8.6. 💾 File Operations</h3>
        <p>Functions for save/load and integration with VariableManager:</p>

        <div class="table-container">
            <table>
                <tr>
                    <th>Function</th>
                    <th>Description</th>
                    <th>Parameters</th>
                    <th>Return</th>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointSave(filename)</span></td>
                    <td>Save mapping to file</td>
                    <td>Filename (can include path)</td>
                    <td>1 if successful, 0 if error</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointLoad(filename)</span></td>
                    <td>Load mapping from file</td>
                    <td>Filename (can include path)</td>
                    <td>1 if successful, 0 if error</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointExport(variableName)</span></td>
                    <td>Export mapping to VariableManager</td>
                    <td>Variable name to save</td>
                    <td>1 if successful, 0 if error</td>
                </tr>
                <tr>
                    <td><span class="inline-code">#cloudPointImport(variableName)</span></td>
                    <td>Import mapping from VariableManager</td>
                    <td>Variable name to load</td>
                    <td>1 if successful, 0 if error</td>
                </tr>
            </table>
        </div>

        <div class="code-block">; Save mapping to file
#cloudPointSave("mapping_camera1.json")

; Load mapping from file
#cloudPointLoad("mapping_camera1.json")

; Export to VariableManager for persistent storage
#cloudPointExport("CameraMapping_Station1")

; Import from VariableManager
#cloudPointImport("CameraMapping_Station1")</div>

        <h3 id="cloud-point-examples">8.7. 🎯 Examples</h3>
        <div class="example">
            <h4>Example 1: Basic Calibration & Transformation</h4>
            <div class="code-block">; === CALIBRATION PHASE ===
; Add some calibration points
#cloudPointAddCalibration(100, 100, 0, 150.5, 200.3, -100, 1.0, "corner1")
#cloudPointAddCalibration(200, 100, 0, 250.8, 200.1, -98, 0.95, "corner2")
#cloudPointAddCalibration(100, 200, 0, 151.2, 300.5, -102, 0.98, "corner3")
#cloudPointAddCalibration(200, 200, 0, 251.1, 300.2, -99, 0.97, "corner4")

; Build grid and validate
#cloudPointBuildGrid(10.0)
#validation_result = #cloudPointValidate(0.2)

IF #validation_result == 1 THEN
    ; Calibration successful!
    
    ; === TRANSFORMATION PHASE ===
    ; Transform object coordinates from camera
    #object_pixel_x = 150
    #object_pixel_y = 150
    
    ; Use Cubic Spline interpolation (method = 2)
    #robot_x = #cloudPointTransformX(#object_pixel_x, #object_pixel_y, 0, 2)
    #robot_y = #cloudPointTransformY(#object_pixel_x, #object_pixel_y, 0, 2)
    #robot_z = #cloudPointTransformZ(#object_pixel_x, #object_pixel_y, 0, 2)
    
    ; Check confidence
    #confidence = #cloudPointGetConfidence(#object_pixel_x, #object_pixel_y, 0, 2)
    IF #confidence > 0.9 THEN
        ; Move robot to object
        G01 X[#robot_x] Y[#robot_y] Z[#robot_z] F1000
        M03 ; Turn on gripper
        G04 P1000
        M05 ; Turn off gripper
    ELSE
        ; Low confidence
    ENDIF
ELSE
    ; Calibration failed. Need more calibration points.
ENDIF</div>
        </div>

        <div class="warning">
            <h4>⚠️ Important Notes about Cloud Point Mapping:</h4>
            <ul>
                <li><strong>Minimum Points:</strong> Need at least 3 points for basic mapping, 5+ points for validation</li>
                <li><strong>Calibration Quality:</strong> Ensure calibration points are evenly distributed in workspace</li>
                <li><strong>Method Selection:</strong> Choose appropriate interpolation method for your data</li>
                <li><strong>Confidence Check:</strong> Always check confidence before moving robot</li>
                <li><strong>Error Tolerance:</strong> Set appropriate error threshold for required accuracy</li>
                <li><strong>Regular Validation:</strong> Regularly validate mapping to ensure accuracy</li>
            </ul>
        </div>

        <h2 id="basic-object-processing">9. 🎯 Basic Object Processing</h2>
        <p>GScript provides basic object processing functions for managing objects detected by the vision system.</p>

        <h3>9.1. Basic Object Management</h3>
        <div class="table-container">
            <table>
                <tr>
                    <th>Function</th>
                    <th>Description</th>
                    <th>Usage</th>
                </tr>
                <tr>
                    <td><span class="inline-code">M98 PaddObject</span></td>
                    <td>Add object to list</td>
                    <td><span class="inline-code">M98 PaddObject objects objectData</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">M98 PclearObjects</span></td>
                    <td>Clear all objects</td>
                    <td><span class="inline-code">M98 PclearObjects objects</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">M98 PdeleteFirstObject</span></td>
                    <td>Delete first object</td>
                    <td><span class="inline-code">M98 PdeleteFirstObject</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">M98 PdeleteObject</span></td>
                    <td>Delete object by ID</td>
                    <td><span class="inline-code">M98 PdeleteObject(5)</span></td>
                </tr>
            </table>
        </div>

        <h3>9.2. Camera Control</h3>
        <div class="table-container">
            <table>
                <tr>
                    <th>Function</th>
                    <th>Description</th>
                    <th>Usage</th>
                </tr>
                <tr>
                    <td><span class="inline-code">M98 PpauseCamera</span></td>
                    <td>Pause camera</td>
                    <td><span class="inline-code">M98 PpauseCamera</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">M98 PcaptureCamera</span></td>
                    <td>Capture image</td>
                    <td><span class="inline-code">M98 PcaptureCamera</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">M98 PresumeCamera</span></td>
                    <td>Resume camera</td>
                    <td><span class="inline-code">M98 PresumeCamera</span></td>
                </tr>
                <tr>
                    <td><span class="inline-code">M98 Pdelay(ms)</span></td>
                    <td>Delay time</td>
                    <td><span class="inline-code">M98 Pdelay(2000)</span></td>
                </tr>
            </table>
        </div>

        <div class="code-block">; Basic object processing example
M98 PclearObjects objects ; Clear all objects
M98 PcaptureCamera ; Capture image
; Object detection happens automatically
; Access first object properties
#first_obj_x = #objects.0.X
#first_obj_y = #objects.0.Y
#first_obj_angle = #objects.0.A

; Move to first object
G01 X[#first_obj_x] Y[#first_obj_y] W[#first_obj_angle]
G01 Z-150
M03 ; Turn on gripper
G04 P1000
G01 Z-50

; Delete processed object
M98 PdeleteFirstObject</div>

        <h2 id="examples">10. 🎯 Practical Examples</h2>

        <h3>10.1. Basic Pick & Place Program</h3>
        <div class="example">
            <div class="code-block">; Simple Pick & Place program
G28 ; Home
G01 F1000 ; Set feedrate

; Pick position
#pick_x = 100
#pick_y = 200
#pick_z = -150

; Place position
#place_x = 300
#place_y = 200
#place_z = -150

; Move to pick position
G01 X[#pick_x] Y[#pick_y] Z-50
G01 Z[#pick_z]
M03 ; Turn on gripper
G04 P1000 ; Wait 1 second
G01 Z-50

; Move to place position
G01 X[#place_x] Y[#place_y]
G01 Z[#place_z]
M05 ; Turn off gripper
G04 P500
G01 Z-50
G28 ; Home</div>
        </div>

        <h3>10.2. Advanced Control Flow Example</h3>
        <div class="example">
            <h4>Using FOR loops with IF conditions:</h4>
            <div class="code-block">; Advanced control flow example
G28 ; Home
#operation_mode = 1

; Check operation mode
IF #operation_mode == 1 THEN
    ; Production mode
    FOR #i = 1 TO 10
        ; Skip defective parts (example: parts 3, 7)
        IF #i == 3 OR #i == 7 THEN
            ; Skip this iteration (would use CONTINUE if implemented)
        ELSE
            ; Process part
            G01 X[#i * 50] Y100 Z-50 F1000
            G01 Z-150
            M03 ; Pick
            G04 P500
            G01 Z-50
            
            ; Place part
            G01 X[300 + #i * 30] Y200
            G01 Z-150
            M05 ; Release
            G04 P500
            G01 Z-50
        ENDIF
    ENDFOR
ELIF #operation_mode == 2 THEN
    ; Testing mode
    FOR #test_counter = 1 TO 5
        ; Test movement
        G01 X[#test_counter * 100] Y150 Z-50 F500
        
        ; Check if position is valid
        IF #test_counter * 100 > 400 THEN
            ; Position out of bounds - would use BREAK if implemented
        ENDIF
        
        G04 P1000 ; Test delay
    ENDFOR
ELSE
    ; Maintenance mode
    G28 ; Home position
    M05 ; Ensure gripper is off
ENDIF

G28 ; Final home</div>
        </div>

        <h3>10.3. Loop with Condition</h3>
        <div class="example">
            <div class="code-block">; Loop to pick 5 objects
#counter = 0
#max_objects = 5

N10 ; Loop label
    IF #counter >= #max_objects THEN GOTO 100
    
    ; Calculate next object position
    #x_pos = 100 + #counter * 50
    
    ; Pick object
    G01 X[#x_pos] Y200 Z-50
    G01 Z-150
    M03
    G04 P1000
    G01 Z-50
    
    ; Place object
    G01 X300 Y[200 + #counter * 30]
    G01 Z-150
    M05
    G01 Z-50
    
    #counter = #counter + 1
    GOTO 10

N100 ; End
G28</div>
        </div>

        <h3>10.4. Using Vision and Tracking</h3>
        <div class="example">
            <div class="code-block">; Program with vision tracking
M98 PcaptureCamera ; Capture image
; Object detection happens automatically

; Get first object in list
#object_x = #objects.0.X
#object_y = #objects.0.Y
#object_angle = #objects.0.A

; Move to object
G01 X[#object_x] Y[#object_y] W[#object_angle]
G01 Z-150
M03

; Delete picked object
M98 PdeleteFirstObject</div>
        </div>

        <h3>10.5. Using Functions</h3>
        <div class="example">
            <div class="code-block">; Define a pick and place function
FUNCTION pickAndPlace(pickX, pickY, pickZ, placeX, placeY, placeZ)
    ; Move to pick position
    G01 X[pickX] Y[pickY] Z-50 F1000
    G01 Z[pickZ]
    M03 ; Turn on gripper
    G04 P1000 ; Wait 1 second
    G01 Z-50
    
    ; Move to place position
    G01 X[placeX] Y[placeY]
    G01 Z[placeZ]
    M05 ; Turn off gripper
    G04 P500
    G01 Z-50
    
    RETURN 1
ENDFUNCTION

; Use the function
G28 ; Home
FOR #i = 1 TO 5
    #pick_x = 100 + #i * 30
    #place_x = 400 + #i * 30
    pickAndPlace(#pick_x, 200, -150, #place_x, 200, -150)
ENDFOR
G28</div>
        </div>

        <div class="warning">
            <h4>⚠️ Important Notes:</h4>
            <ul>
                <li>Always test programs in safe mode before running</li>
                <li>Ensure robot is homed before starting</li>
                <li>Check robot workspace limits</li>
                <li>Use low speed when testing new programs</li>
                <li>Always have Emergency Stop ready</li>
            </ul>
        </div>

        <div class="example">
            <h4>💡 Tips and Tricks:</h4>
            <ul>
                <li>🔧 Use subprograms and functions to reuse code</li>
                <li>📝 Add comments to make code easy to understand</li>
                <li>🔢 Use variables to make code more flexible</li>
                <li>⚡ Optimize by reducing unnecessary movements</li>
                <li>🧪 Test small parts before assembling</li>
            </ul>
        </div>

        <hr>
        <footer style="text-align: center; margin-top: 40px; color: #7f8c8d;">
            <p><strong>Delta X Software</strong> - Automation Made Simple<br>
            © 2024 - GScript User Guide</p>
        </footer>
    </div>
</body>
</html> 

